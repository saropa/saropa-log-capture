# Internationalization Best Practices

**Extension:** Saropa Log Capture
**Date:** 2026-02-18
**Scope:** Reference guide for adding manifest localization via `package.nls.json`

---

## 1. Current State

**Manifest localization is implemented.** All 127 user-visible strings in `package.json` use `%key%` references resolved from `package.nls.json` (English default). No locale-specific translation files exist yet. There is no runtime translation system (`vscode.l10n.t()`).

Key alignment between `package.json` and `package.nls*.json` can be verified with `npm run verify-nls`.

## 2. VS Code Localization Layers

VS Code extensions have two distinct localization layers:

| Layer | Mechanism | What it localizes |
|-------|-----------|-------------------|
| **Manifest** | `package.nls.json` files | Command titles, setting descriptions, view names — anything in `package.json` that users see in the VS Code UI |
| **Runtime** | `vscode.l10n.t()` API or custom i18n | Status bar text, notifications, webview content — strings generated by extension code at runtime |

Manifest localization is the higher-impact starting point since it covers the Settings UI and Command Palette — the two places users most interact with extension strings.

## 3. What Would Need Localization

Based on the current `package.json`, manifest localization would cover:

| Category | Approximate count |
|----------|-------------------|
| Top-level fields (`displayName`, `description`) | 2 |
| Command titles | ~40 |
| View/container titles | 3 |
| Configuration section title | 1 |
| Setting descriptions | ~35 |
| Enum descriptions | ~10 |
| Walkthrough titles and descriptions | ~10 |

Each string would become a `%key%` reference in `package.json` pointing to keys in `package.nls.json`.

## 4. Best Practices

### 4.1 Use `package.nls.json` for Manifest Strings

VS Code resolves `%key%` references in `package.json` at extension load time, before any extension code runs. This is the only mechanism that localizes command palette entries, settings UI descriptions, and view titles.

**Rule:** Never hardcode user-visible strings directly in `package.json`. Use `%key%` references pointing to `package.nls.json`.

### 4.2 Flat Dot-Notation Key Naming

**Pattern:**
```
{category}.{subcategory}.{field}
```

**Examples for this project:**
- `command.start.title` → "Saropa Log Capture: Start Capture"
- `config.logDirectory.description` → "Directory for log files, relative to workspace root."
- `config.firebase.timeRange.enum.last7Days` → "Last 7 days"
- `walkthrough.startDebugging.title` → "Start a Debug Session"

The `package.nls.json` format requires flat keys (no nesting). Dot-notation provides logical grouping.

### 4.3 Lowercase Locale Codes in Filenames

VS Code normalizes locale codes to lowercase when resolving nls files:

| VS Code locale | Resolves to file |
|----------------|------------------|
| `de` | `package.nls.de.json` |
| `de-DE` | `package.nls.de.json` (falls back to base language) |
| `zh-CN` | `package.nls.zh-cn.json` |
| `zh-TW` | `package.nls.zh-tw.json` |

**Rule:** Always use lowercase locale codes in nls filenames. Use the base language code (`de`) unless two regional variants are needed (as with `zh-cn` vs `zh-tw`).

### 4.4 Keep Brand Names Untranslated

`displayName`, `viewsContainers.title`, and `configuration.title` should remain `"Saropa Log Capture"` across every locale. The command prefix `"Saropa Log Capture:"` should also be preserved.

**Why:** Product names are brand identifiers. Translating them prevents users from finding the extension by name in non-English locales.

### 4.5 Preserve Technical Terms in Latin Script

Setting descriptions should keep technical terms untranslated:
- Protocol terms: DAP, ANSI, stderr, stdout
- Format names: CSV, JSON, JSONL, HTML
- VS Code concepts: Debug Console, Activity Bar, webview
- Firebase/Google terms: Crashlytics, Play Vitals, GCP
- Code identifiers: `.log`, `.gitignore`, `reports/`
- Regex patterns and examples

**Why:** These terms are universally understood in the developer community and don't have standard translations. Translating "DAP" or "stderr" would confuse users reading VS Code or debug adapter documentation.

### 4.6 Preserve Numeric Values and Defaults

Numbers like `100000`, `1000`, `300`, `3s`, `10s`, `30s` should remain unchanged across locales.

**Why:** These are settings defaults and limits. Localizing number formatting within JSON description strings would be confusing since the actual setting values use invariant notation.

### 4.7 Complete Coverage — No Partial Translations

Every locale file must contain all keys. Zero missing entries.

**Why:** VS Code falls back to the English default for missing keys, creating a jarring mixed-language UI. A user with `ja` locale seeing mostly Japanese descriptions with random English ones would be a poor experience.

**Verification:** Key alignment should be verified programmatically (compare key sets across all nls files).

### 4.8 Fallback Chain

VS Code's nls resolution follows this chain:

```
package.nls.{exact-locale}.json
  → package.nls.{base-language}.json
    → package.nls.json (English default)
```

**Example for a user with locale `de-AT` (Austrian German):**
1. Look for `package.nls.de-at.json` — not found
2. Fall back to `package.nls.de.json` — found, use it

This means supporting `de` covers all German variants (de-DE, de-AT, de-CH).

### 4.9 VSIX Packaging Safety

Add a negation pattern to `.vscodeignore` to ensure locale files ship in the VSIX:

```
!package.nls*.json
```

This prevents future `.vscodeignore` edits from accidentally excluding locale files.

## 5. What NOT to Do

### 5.1 Do Not Use `"Language Packs"` Category

The VS Code Marketplace `"Language Packs"` category is reserved exclusively for extensions that localize VS Code's own UI (e.g., Microsoft's Japanese Language Pack). It is not appropriate for extensions that offer their own UI in multiple languages.

### 5.2 Do Not Localize the Marketplace Listing

The VS Code Marketplace always shows the English `displayName` and `description` from `package.json`, regardless of locale. There is no mechanism to provide localized Marketplace listings. Localized `description` in nls files only appears in VS Code's Extensions view.

### 5.3 Do Not Add Native-Script Keywords Prematurely

Adding keywords like `日本語` or `中文` to `package.json` only makes sense if the extension actually has translations in those languages. Adding them without localization is misleading.

## 6. Implementation Checklist

If localization is added in the future:

1. Create `package.nls.json` with all user-visible strings keyed by dot-notation
2. Replace all hardcoded strings in `package.json` with `%key%` references
3. Create locale-specific files (e.g., `package.nls.de.json`, `package.nls.ja.json`)
4. Add `!package.nls*.json` to `.vscodeignore`
5. Verify key alignment across all locale files (no missing/extra keys)
6. Consider adding native-script language keywords to `package.json` for discoverability
7. Decide whether runtime strings (status bar, notifications, webview) need a separate i18n layer

## 7. Adding a New Setting (After Localization Exists)

When adding a new setting to `package.json`:

1. Add the `%config.newSetting.description%` reference in `package.json`
2. Add the English value to `package.nls.json`
3. Add translated values to all locale files
4. Run key alignment verification

## 8. References

- [VS Code Extension Manifest](https://code.visualstudio.com/api/references/extension-manifest) — official documentation for `package.json` fields
- [VS Code Localization](https://code.visualstudio.com/api/working-with-extensions/publishing-extension#localization) — publishing localized extensions
- [microsoft/vscode-extension-samples/l10n-sample](https://github.com/microsoft/vscode-extension-samples/tree/main/l10n-sample) — official localization sample
- [@vscode/l10n-dev](https://www.npmjs.com/package/@vscode/l10n-dev) — tooling for string extraction and XLIFF generation
